#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üîç Running pre-commit checks..."

# –ó–∞–ø—É—Å–∫–∞–µ–º lint-staged –¥–ª—è –∞–≤—Ç–æ–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
echo "üìù Running lint-staged..."
npx lint-staged

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ TypeScript
echo "üîé Running TypeScript type check..."
npm run type-check || {
  echo "‚ùå TypeScript type check failed!"
  exit 1
}

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–Ω—Ç–∏–Ω–≥–∞ (–ø–æ—Å–ª–µ –∞–≤—Ç–æ–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π)
echo "üßπ Running ESLint..."
npm run lint || {
  echo "‚ùå ESLint check failed!"
  exit 1
}

# –ê–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
echo "‚ú® Formatting code..."
npm run format

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
echo "‚ú® Verifying code formatting..."
npm run format:check || {
  echo "‚ùå Code formatting verification failed!"
  exit 1
}

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∏–ª–¥–∞
echo "üèóÔ∏è  Running build check..."
echo "–û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å–±–æ—Ä–∫–∏..."
rm -rf .next
npm run build || {
  echo "‚ùå Build check failed!"
  echo "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—à–∏–±–∫–∏ —Å–±–æ—Ä–∫–∏ –≤—ã—à–µ"
  exit 1
}
echo "‚úÖ Build successful!"

echo "‚úÖ All pre-commit checks passed!"
